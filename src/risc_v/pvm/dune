; This file was automatically generated, do not edit.
; Edit file manifest/main.ml instead.

(library
 (name octez_risc_v_pvm)
 (public_name octez-risc-v-pvm)
 (instrumentation (backend bisect_ppx))
 (libraries
  octez-l2-libs.layer2_store)
 (flags
  (:standard)
  -w -9-27-66)
 (foreign_archives octez_risc_v_pvm))

(subdir
 helpers/bin
 (rule
  (target armerge)
  (enabled_if (= %{system} macosx))
  (action
   (chdir
    ../..
    (run
     cargo
     install
     --locked
     armerge
     --version
     2.0.0
     --bins
     --target-dir
     target
     --root
     helpers)))))

(rule
 (targets liboctez_risc_v_pvm.a octez_risc_v_pvm.ml octez_risc_v_pvm.mli)
 (deps
  (file Cargo.toml)
  (file build.rs)
  (source_tree src)
  (file ../Cargo.lock)
  (file ../Cargo.toml)
  (source_tree ../kernel_loader)
  (source_tree ../interpreter)
  (file ../sandbox/Cargo.toml)
  (source_tree ../../kernel_sdk/constants)
  (file ../../kernel_sdk/constants/Cargo.toml)
  (file ../../kernel_sdk/core/Cargo.toml)
  (file ../../kernel_sdk/host/Cargo.toml)
  (file ../../kernel_sdk/encoding/Cargo.toml))
 (enabled_if (<> %{system} macosx))
 (action
  (no-infer
   (progn
    (run cargo build --release -p octez-risc-v-pvm)
    (copy ../target/release/liboctez_risc_v_pvm.a liboctez_risc_v_pvm.a)))))

(rule
 (targets liboctez_risc_v_pvm.a octez_risc_v_pvm.ml octez_risc_v_pvm.mli)
 (deps
  (file Cargo.toml)
  (file build.rs)
  (source_tree src)
  (file ../Cargo.lock)
  (file ../Cargo.toml)
  (source_tree ../kernel_loader)
  (source_tree ../interpreter)
  (file ../sandbox/Cargo.toml)
  (source_tree ../../kernel_sdk/constants)
  (file ../../kernel_sdk/constants/Cargo.toml)
  (file ../../kernel_sdk/core/Cargo.toml)
  (file ../../kernel_sdk/host/Cargo.toml)
  (file ../../kernel_sdk/encoding/Cargo.toml)
  (file helpers/bin/armerge))
 (enabled_if (= %{system} macosx))
 (action
  (no-infer
   (progn
    (run cargo build --release -p octez-risc-v-pvm)
    (run
     helpers/bin/armerge
     --keep-symbols=^_?octez_
     ../target/release/liboctez_risc_v_pvm.a
     --output
     liboctez_risc_v_pvm.a)))))
