; This file was automatically generated, do not edit.
; Edit file manifest/main.ml instead.

(library
 (name octez_risc_v)
 (public_name octez-risc-v)
 (instrumentation (backend bisect_ppx))
 (flags
  (:standard)
  -w -9-27-66)
 (foreign_archives octez_risc_v_api))

(dirs :standard .cargo)

(subdir
 helpers/bin
 (rule
  (target armerge)
  (enabled_if (= %{system} macosx))
  (action
   (chdir
    ../..
    (run
     cargo
     install
     --locked
     armerge
     --version
     2.0.0
     --bins
     --target-dir
     target
     --root
     helpers)))))

(rule
 (targets liboctez_risc_v_api.a dlloctez_risc_v_api.so)
 (deps
  (file Cargo.lock)
  (file Cargo.toml)
  (source_tree .cargo)
  (source_tree api)
  (source_tree pvm)
  (source_tree kernel_loader)
  (source_tree interpreter)
  (file sandbox/Cargo.toml)
  (source_tree ../kernel_sdk/constants)
  (file ../kernel_sdk/constants/Cargo.toml)
  (file ../kernel_sdk/core/Cargo.toml)
  (file ../kernel_sdk/host/Cargo.toml)
  (file ../kernel_sdk/encoding/Cargo.toml))
 (enabled_if (<> %{system} macosx))
 (action
  (no-infer
   (progn
    (run cargo build --release -p octez-risc-v-api)
    (copy target/release/liboctez_risc_v_api.a liboctez_risc_v_api.a)
    (copy target/release/liboctez_risc_v_api.so dlloctez_risc_v_api.so)))))

(rule
 (targets liboctez_risc_v_api.a dlloctez_risc_v_api.so)
 (deps
  (file Cargo.lock)
  (file Cargo.toml)
  (source_tree .cargo)
  (source_tree api)
  (source_tree pvm)
  (source_tree kernel_loader)
  (source_tree interpreter)
  (file sandbox/Cargo.toml)
  (source_tree ../kernel_sdk/constants)
  (file ../kernel_sdk/constants/Cargo.toml)
  (file ../kernel_sdk/core/Cargo.toml)
  (file ../kernel_sdk/host/Cargo.toml)
  (file ../kernel_sdk/encoding/Cargo.toml)
  (file helpers/bin/armerge))
 (enabled_if (= %{system} macosx))
 (action
  (no-infer
   (progn
    (run cargo build --release -p octez-risc-v-api)
    (run
     helpers/bin/armerge
     --keep-symbols=^_?octez_
     target/release/liboctez_risc_v_api.a
     --output
     liboctez_risc_v_api.a)
    (copy target/release/liboctez_risc_v_api.dylib dlloctez_risc_v_api.so)))))
