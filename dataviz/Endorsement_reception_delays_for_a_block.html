<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Endorsement reception delays</title>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.4.4/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"
        integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>

<body>
    <script type="text/javascript" src="./js/populate_sort_data.js"></script>
    <form>
        <h1>Endorsement reception delays</h1>
        <label for="selectedLevel">Level</label>
        <tr>
            <td rowspan="2">
                <input name="level" id="selectedLevel" type="number" value="179000" />
            </td>
            <td>
                <input id="plus" type="button" value=" Next " onclick="this.form.level.value++;">
            </td>
        </tr>
        <tr>
            <td><input id="moins" type=button value=" Previous " onclick="this.form.level.value--;"></td>
        </tr>
    </form>
    <script>
        const server_adress = "http://kathmandunet.kaml.fr:8880/";

        /*function MessageErreur() {
            try {
                const elements5 = document.querySelector("p");
                const myNode = document.querySelector("p");;
                while (myNode.firstChild) {
                    myNode.removeChild(myNode.lastChild);
                }
            } catch (e) {
                console.log(e)
            }
            try {
                const elements2 = document.getElementById("tab_delegates").querySelector("h2")
                elements2.parentElement.removeChild(elements2);
            } catch (e) {
                //console.log(e)
            }
            try {
                const elements = document.getElementById("tab_delegates").querySelector("table");
                elements.parentElement.removeChild(elements);
            } catch (e) {
                // console.log(e)
            }

            try {
                while (document.getElementById("resume").querySelector("h2")) {
                    const elements3 = document.getElementById("resume").querySelector("h2");
                    document.getElementById("resume").removeChild(elements3);
                }
            } catch (e) {
                console.log(e)
            }
            try {
                const elements4 = document.getElementById("resume").querySelector("table");
                elements4.parentElement.removeChild(elements4);
            } catch (e) {
                //console.log(e)
            }
            if (document.getElementById("resume").querySelector("h2")) {

            }
            else {
                var mess_erreur = document.createElement('h2');
                mess_erreur.appendChild(document.createTextNode("Oops, i can't find this block !"));
                document.getElementById("resume").appendChild(mess_erreur);
            }

        }*/
        function main() {
            try {
                $('form').keyup(function (e) {
                    var va = document.getElementById('selectedLevel').value; e.target.value;
                    let dict_data = populate_v1(server_adress, va, va).then(dict_data => {
                        let ditribution_delays = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_bloc(dict_data);
                        let t_delai_bloc=result[0]
                        let t_baker=result[1]
                        let max_round=result[2]  
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart('p', [ditribution_delays[0][va][i], ditribution_delays[1][va][i]], va, i, t_delai_bloc[i]);
                        }

                    });
                });

                //Réagir à un click sur les boutons 
                $('#plus').click(function (e) {
                    var va = document.getElementById('selectedLevel').value; e.target.value;
                    let dict_data = populate_v1(server_adress, va, va).then(dict_data => {
                        let ditribution_delays = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_bloc(dict_data);
                        let t_delai_bloc=result[0]
                        let t_baker=result[1]
                        let max_round=result[2]
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart('p', [ditribution_delays[0][va][i], ditribution_delays[1][va][i]], va, i, t_delai_bloc[i]);
                        }
                    });
                });

                $('#moins').click(function (e) {
                    var va = document.getElementById('selectedLevel').value; e.target.value;
                    let dict_data = populate_v1(server_adress, va, va).then(dict_data => {
                        let distrib_t = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_bloc(dict_data);
                        let t_delai_bloc=result[0]
                        let t_baker=result[1]
                        let max_round=result[2]
                        console.log(t_baker)
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart('p', [distrib_t[0][va][i], distrib_t[1][va][i]], va, i, t_delai_bloc[i]);
                        }
                    });
                });



            } catch (erreur) {
                console.log(erreur);
            }
        }
        main()


    </script>
    <p></p>
    <br>
    <br>
    <div id="tab_delegates"></div>
    <div id="resume"></div>
</body>