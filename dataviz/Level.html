<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Endorsement reception delays</title>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.4.4/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"
        integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>

<body>
    <script type="text/javascript" src="./js/populate_sort_data.js"></script>
    <script type="text/javascript" src="./js/local_config.js"></script>
    <form>
        <h1>Endorsement reception delays</h1>
        <label for="selectedLevel">Level</label>
        <tr>
            <td rowspan="2">
                <input name="level" id="selectedLevel" type="number" />
            </td>
            <td>
                <input id="plus" type="button" value=" Next " onclick="this.form.level.value++;">
            </td>
        </tr>
        <tr>
            <td><input id="moins" type=button value=" Previous " onclick="this.form.level.value--;"></td>
        </tr>
    </form>
    <script>
        function main() {
            try {
                const params = new Proxy(new URLSearchParams(window.location.search), { // to input parameters in URL
                    get: (searchParams, prop) => searchParams.get(prop),
                });
                // Get the value of "some_key" in eg "https://example.com/?some_key=some_value"
                let block_value = parseInt(params.block); // "some_value"
                //console.log()
                if(block_value){
                    let dict_data = populate_v1(server_adress, block_value, block_value).then(dict_data => {
                        let ditribution_delays = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_block(dict_data);
                        let t_delay_block = result[0]
                        let t_baker = result[1]
                        let max_round = result[2]
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart_delays_for_a_block('p', [ditribution_delays[0][block_value][i], ditribution_delays[1][block_value][i]], block_value, i, t_delay_block[i]);
                        }

                    });

                }
                $('form').keyup(function (e) {
                    var va = document.getElementById('selectedLevel').value; e.target.value;
                    let dict_data = populate_v1(server_adress, va, va).then(dict_data => {
                        let ditribution_delays = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_block(dict_data);
                        let t_delay_block = result[0]
                        let t_baker = result[1]
                        let max_round = result[2]
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart_delays_for_a_block('p', [ditribution_delays[0][va][i], ditribution_delays[1][va][i]], va, i, t_delay_block[i]);
                        }

                    });
                });

                $('#plus').click(function (e) {
                    var va = document.getElementById('selectedLevel').value; e.target.value;
                    let dict_data = populate_v1(server_adress, va, va).then(dict_data => {
                        let ditribution_delays = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_block(dict_data);
                        let t_delay_block = result[0]
                        let t_baker = result[1]
                        let max_round = result[2]
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart_delays_for_a_block('p', [ditribution_delays[0][va][i], ditribution_delays[1][va][i]], va, i, t_delay_block[i]);
                        }
                    });
                });

                $('#moins').click(function (e) {
                    var va = document.getElementById('selectedLevel').value; e.target.value;
                    let dict_data = populate_v1(server_adress, va, va).then(dict_data => {
                        let distrib_t = delays_distribution_of_operations(dict_data)
                        let logs_operation = classify_operations(dict_data)
                        let result = get_info_block(dict_data);
                        let t_delay_block = result[0]
                        let t_baker = result[1]
                        let max_round = result[2]
                        console.log(t_baker)
                        resume_obs(logs_operation, t_baker);
                        replaceDelegate(logs_operation);
                        for (let i = 0; i <= max_round; i++) {
                            chart_delays_for_a_block('p', [distrib_t[0][va][i], distrib_t[1][va][i]], va, i, t_delay_block[i]);
                        }
                    });
                });

            } catch (erreur) {
                console.log(erreur);
            }
        }
        main()

    </script>
    <p></p>
    <br>
    <br>
    <div id="tab_delegates"></div>
    <div id="resume"></div>
</body>
