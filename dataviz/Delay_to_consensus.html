<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Time required to receive n% of validated pre-endorsements</title>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.4.4/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"
        integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <script type="text/javascript" src="./js/populate_sort_data.js"></script>
    <h1> Time required to receive n% of validated pre-endorsements</h1>
    <form>
        <div>
            <label for="selectedLevel_begin">First bloc:</label>
            <input name="level_" id="selectedLevel_begin" type="number" value="179000" />
            <span id='tick_begin'></span>
            <br>
            <label for="selectedLevel_end">Last bloc:</label>
            <input name="level_" id="selectedLevel_end" type="number" value="179050" />
            <span id='tick_end'></span>
            <br>
            <label for="selectedThreshold">Percentage threshold (n):</label>
            <input name="threshold" id="selectedThreshold" type="number" value="66" />
            <br>
            <input type="button" id="submit_" value="Search ">

        </div>
        <div id="beta"></div>
    </form>
    <script>

        const server_adress = "http://kathmandunet.kaml.fr:8880/";
        
        function main() {
            try {
                $('#submit_').mouseup(function (e) {
                    beg_ = document.getElementById('selectedLevel_begin').value;
                    end_ = document.getElementById('selectedLevel_end').value;
                    threshold_ = document.getElementById('selectedThreshold').value;
                    let dict_data= populate_v1(server_adress, beg_, end_).then(dict_data =>{

                    console.log(dict_data)
                    let t_op_valide_array = delays_distribution_of_operations(dict_data);
                    console.log(t_op_valide_array)
                    let endorsing_power= get_endorsing_power(dict_data)
                    let t_op_valide_dict = delays_distribution_of_operations_w_delegate(dict_data);
                    console.log("endorsing_power", endorsing_power)
                    console.log("t_op_valide_dict", t_op_valide_dict)
                    let results = TimeForPercIntegration_w_endorsing_power(threshold_, t_op_valide_dict[0], endorsing_power)

                
                    //let results = TimeForPercIntegration(threshold_, t_op_valide_array[0])
                    console.log(results)
                    chart_time_required(results); 
                })

                });


            } catch (e) {
                console.log(e)
            }
        }
        main()

    </script>
</body>

