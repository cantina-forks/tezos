# This file was automatically generated, do not edit.
# Edit file ci/bin/main.ml instead.

workflow:
  rules:
  - if: $foo != "bar" || $foo == "bar"
    when: always

stages:
- start
- sanity
- build
- test
- test_coverage
- packaging
- doc
- prepare_release
- publish_release_gitlab
- publish_release
- publish_package_gitlab
- manual

oc.docker-build-debian-dependencies:
  image: ${GCP_REGISTRY}/tezos/docker-images/ci-docker:v1.12.0
  stage: build
  tags:
  - $TAGS
  dependencies: []
  before_script:
  - ./scripts/ci/docker_initialize.sh
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages-dependencies.sh
  services:
  - docker:${DOCKER_VERSION}-dind
  variables:
    DOCKER_VERSION: 24.0.6
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: debian
  parallel:
    matrix:
    - RELEASE:
      - unstable
      - bookworm
      TAGS:
      - gcp
      - gcp_arm64

oc.docker-build-ubuntu-dependencies:
  image: ${GCP_REGISTRY}/tezos/docker-images/ci-docker:v1.12.0
  stage: build
  tags:
  - $TAGS
  dependencies: []
  before_script:
  - ./scripts/ci/docker_initialize.sh
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages-dependencies.sh
  services:
  - docker:${DOCKER_VERSION}-dind
  variables:
    DOCKER_VERSION: 24.0.6
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: ubuntu
  parallel:
    matrix:
    - RELEASE:
      - focal
      - jammy
      TAGS:
      - gcp
      - gcp_arm64

oc.build-debian:
  image: $DEP_IMAGE:${CI_COMMIT_REF_SLUG}
  stage: packaging
  tags:
  - $TAGS
  dependencies: []
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages.sh
  variables:
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: debian
  artifacts:
    paths:
    - packages/$DISTRIBUTION/$RELEASE
  parallel:
    matrix:
    - RELEASE:
      - unstable
      - bookworm
      TAGS:
      - gcp
      - gcp_arm64

oc.build-ubuntu:
  image: $DEP_IMAGE:${CI_COMMIT_REF_SLUG}
  stage: packaging
  tags:
  - $TAGS
  dependencies: []
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages.sh
  variables:
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: ubuntu
  artifacts:
    paths:
    - packages/$DISTRIBUTION/$RELEASE
  parallel:
    matrix:
    - RELEASE:
      - focal
      - jammy
      TAGS:
      - gcp
      - gcp_arm64
