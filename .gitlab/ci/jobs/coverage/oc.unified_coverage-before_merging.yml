# This file was automatically generated, do not edit.
# Edit file ci/bin/main.ml instead.

oc.unified_coverage:
  image: ${build_deps_image_name}:runtime-e2etest-dependencies--${build_deps_image_version}
  stage: test_coverage
  tags:
  - gcp
  rules:
  - if: $GITLAB_USER_LOGIN == "nomadic-margebot"
    when: never
  - changes:
    - .gitlab-ci.yml
    - .gitlab/**/*
    - etherlink/**/*
    - michelson_test_scripts/**/*
    - src/**/*
    - tezt/**/*
    - tzt_reference_test_suite/**/*
    when: on_success
  dependencies:
  - oc.unit:non-proto-x86_64
  - oc.unit:other-x86_64
  - oc.unit:proto-x86_64
  - tezt-flaky
  - tezt
  - tezt-memory-4k
  - tezt-memory-3k
  - tezt-time-sensitive
  allow_failure:
    exit_codes: 64
  script:
  - ./scripts/ci/report_coverage.sh || exit $?
  variables:
    TEZOS_WITHOUT_OPAM: "true"
    BISECT_FILE: $CI_PROJECT_DIR/_coverage_output/
    SLACK_COVERAGE_CHANNEL: C02PHBE7W73
  artifacts:
    expire_in: 15 days
    paths:
    - _coverage_report/
    - $BISECT_FILE
    reports:
      coverage_report:
        coverage_format: cobertura
        path: _coverage_report/cobertura.xml
    when: always
    expose_as: Coverage report
  coverage: '/Coverage: ([^%]+%)/'
