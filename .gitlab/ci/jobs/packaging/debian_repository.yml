# This file was automatically generated, do not edit.
# Edit file ci/bin/main.ml instead.

oc.docker-build-debian-dependencies:
  image: ${GCP_REGISTRY}/tezos/docker-images/ci-docker:v1.10.0
  stage: build
  tags:
  - $TAGS
  rules:
  - changes:
    - .gitlab-ci.yml
    - debian-deps-build.Dockerfile
    - scripts/version.sh
    when: on_success
  - when: manual
    allow_failure: true
  needs:
  - trigger
  dependencies: []
  before_script:
  - ./scripts/ci/docker_initialize.sh
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages-dependencies.sh
  services:
  - docker:${DOCKER_VERSION}-dind
  variables:
    DOCKER_VERSION: 24.0.6
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: debian
  parallel:
    matrix:
    - RELEASE:
      - unstable
      - bookworm
      TAGS:
      - gcp
      - gcp_arm64

oc.docker-build-ubuntu-dependencies:
  image: ${GCP_REGISTRY}/tezos/docker-images/ci-docker:v1.10.0
  stage: build
  tags:
  - $TAGS
  rules:
  - changes:
    - .gitlab-ci.yml
    - debian-deps-build.Dockerfile
    - scripts/version.sh
    when: on_success
  - when: manual
    allow_failure: true
  needs:
  - trigger
  dependencies: []
  before_script:
  - ./scripts/ci/docker_initialize.sh
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages-dependencies.sh
  services:
  - docker:${DOCKER_VERSION}-dind
  variables:
    DOCKER_VERSION: 24.0.6
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: ubuntu
  parallel:
    matrix:
    - RELEASE:
      - focal
      - jammy
      TAGS:
      - gcp
      - gcp_arm64

oc.build-debian-based-packages:
  image: alpine:3.18
  stage: manual
  tags:
  - gcp
  needs: []
  dependencies: []
  script:
  - echo 'Trigger build debian packages'
  when: manual

oc.build-debian:
  image: $DEP_IMAGE:${CI_COMMIT_REF_SLUG}
  stage: manual
  tags:
  - $TAGS
  needs:
  - oc.build-debian-based-packages
  dependencies: []
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages.sh
  variables:
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: debian
  artifacts:
    paths:
    - packages/$DISTRIBUTION/$RELEASE
  parallel:
    matrix:
    - RELEASE:
      - unstable
      - bookworm
      TAGS:
      - gcp
      - gcp_arm64

oc.build-ubuntu:
  image: $DEP_IMAGE:${CI_COMMIT_REF_SLUG}
  stage: manual
  tags:
  - $TAGS
  needs:
  - oc.build-debian-based-packages
  dependencies: []
  script:
  - .gitlab/ci/jobs/packaging/build-debian-packages.sh
  variables:
    DEP_IMAGE: registry.gitlab.com/tezos/tezos/build-$DISTRIBUTION-$RELEASE
    DISTRIBUTION: ubuntu
  artifacts:
    paths:
    - packages/$DISTRIBUTION/$RELEASE
  parallel:
    matrix:
    - RELEASE:
      - focal
      - jammy
      TAGS:
      - gcp
      - gcp_arm64
